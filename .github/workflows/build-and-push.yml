 name: Build and Push to GHCR                                                                                                                                                                                   
                                                                                                                                                                                                                 
  on:                                                                                                                                                                                                            
    push:                                                                                                                                                                                                        
      branches: [main]                                                                                                                                                                                           
    workflow_dispatch:                                                                                                                                                                                           
                                                                                                                                                                                                                 
  env:                                                                                                                                                                                                           
    REGISTRY: ghcr.io                                                                                                                                                                                            
    IMAGE_NAME: ${{ github.repository }}                                                                                                                                                                         
                                                                                                                                                                                                                 
  jobs:                                                                                                                                                                                                          
    build-and-push:                                                                                                                                                                                              
      runs-on: ubuntu-latest                                                                                                                                                                                     
      permissions:                                                                                                                                                                                               
        contents: read                                                                                                                                                                                           
        packages: write                                                                                                                                                                                          
                                                                                                                                                                                                                 
      steps:                                                                                                                                                                                                     
        - name: Checkout                                                                                                                                                                                         
          uses: actions/checkout@v4                                                                                                                                                                              
                                                                                                                                                                                                                 
        - name: Log in to GitHub Container Registry                                                                                                                                                              
          uses: docker/login-action@v3                                                                                                                                                                           
          with:                                                                                                                                                                                                  
            registry: ${{ env.REGISTRY }}                                                                                                                                                                        
            username: ${{ github.actor }}                                                                                                                                                                        
            password: ${{ secrets.GITHUB_TOKEN }}                                                                                                                                                                
                                                                                                                                                                                                                 
        - name: Extract metadata                                                                                                                                                                                 
          id: meta                                                                                                                                                                                               
          uses: docker/metadata-action@v5                                                                                                                                                                        
          with:                                                                                                                                                                                                  
            images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}                                                                                                                                                    
            tags: |
              type=raw,value=latest                                                                                                                                                                              
              type=sha,prefix=                                                                                                                                                                                   
                                                                                                                                                                                                                 
        - name: Build and push                                                                                                                                                                                   
          uses: docker/build-push-action@v5                                                                                                                                                                      
          with:                                                                                                                                                                                                  
            context: ./CuteBunnyWebApp                                                                                                                                                                           
            push: true                                                                                                                                                                                           
            tags: ${{ steps.meta.outputs.tags }}                                                                                                                                                                 
            labels: ${{ steps.meta.outputs.labels }}                                                                                                                                                             
            build-args: |
              APP_KEY=${{ secrets.APP_KEY }}                                                                                                                                                                     
              DB_CONNECTION=${{ secrets.DB_CONNECTION }}                                                                                                                                                         
              DB_HOST=${{ secrets.DB_HOST }}                                                                                                                                                                     
              DB_PORT=${{ secrets.DB_PORT }}                                                                                                                                                                     
              DB_DATABASE=${{ secrets.DB_DATABASE }}                                                                                                                                                             
              DB_USERNAME=${{ secrets.DB_USERNAME }}                                                                                                                                                             
              DB_PASSWORD=${{ secrets.DB_PASSWORD }}                                                                                                                                                             
              PEXELS_API_KEY=${{ secrets.PEXELS_API_KEY }}                                                                                                                                                       
              OPENROUTER_AI_KEY=${{ secrets.OPENROUTER_AI_KEY }}    